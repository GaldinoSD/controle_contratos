{% extends "base.html" %}
{% block content %}

<div class="space-y-10">

  <!-- ======================================================
       HEADER COMPACTO — ÁREA DA DIRETORIA
  ====================================================== -->
  <section class="relative overflow-hidden rounded-2xl p-6 shadow-xl 
                  bg-white/70 dark:bg-slate-900/80 
                  border border-slate-300 dark:border-slate-800 
                  backdrop-blur">

    <div class="absolute -top-10 -left-10 w-32 h-32 bg-blue-500/10 dark:bg-blue-600/20 
                blur-2xl rounded-full opacity-40"></div>

    <div class="relative flex flex-col md:flex-row md:items-center md:justify-between gap-4">

      <!-- ESQUERDA -->
      <div class="flex items-center gap-4">
        <span class="p-3 bg-blue-500/10 dark:bg-blue-600/20 
                     border border-blue-300/40 dark:border-blue-500/40 
                     rounded-xl shadow">
          <i class="fa-solid fa-user-shield text-2xl text-blue-600 dark:text-blue-300"></i>
        </span>

        <div>
          <h1 class="text-2xl font-bold text-slate-800 dark:text-white tracking-tight">
            Área da Diretoria
          </h1>

          <p class="text-xs text-slate-600 dark:text-slate-400 mt-1">
            Gerenciamento de contas administrativas.
          </p>
        </div>
      </div>

      <!-- DIREITA -->
      <div class="flex flex-col items-start md:items-end gap-1">
        <button onclick="abrirModalNovoAdmin()"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold 
                       px-5 py-2 rounded-lg shadow flex items-center gap-2">
          <i class="fa-solid fa-user-plus text-sm"></i>
          Novo Admin
        </button>

        <p class="text-[10px] text-slate-500 dark:text-slate-400">
          Perfis essenciais apenas.
        </p>
      </div>

    </div>
  </section>

  <!-- ======================================================
       GRID DE ADMINISTRADORES
  ====================================================== -->
  <section class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">

    {% for admin in admins %}
    <div class="relative p-4 rounded-2xl shadow-xl 
                bg-white dark:bg-slate-900/70 
                border border-slate-300 dark:border-slate-800
                backdrop-blur transition-all">

      <!-- FITA -->
      {% if admin.email == 'admin@admin.com' %}
      <div class="absolute -top-2 -right-2">
        <span class="inline-flex items-center gap-1 px-2 py-0.5 text-[10px]
                     rounded-full bg-yellow-300 text-slate-800 font-bold shadow 
                     border border-yellow-400">
          <i class="fa-solid fa-crown text-xs"></i> Super
        </span>
      </div>
      {% else %}
      <div class="absolute -top-2 -right-2">
        <span class="inline-flex items-center gap-1 px-2 py-0.5 text-[10px]
                     rounded-full bg-slate-200 dark:bg-slate-800 
                     text-slate-800 dark:text-slate-200 
                     border border-slate-300 dark:border-slate-700 shadow">
          <i class="fa-solid fa-user-tie text-xs"></i> Admin
        </span>
      </div>
      {% endif %}

      <!-- TOPO -->
      <div class="flex items-center gap-4 mb-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br 
                    from-blue-600 to-blue-400
                    flex items-center justify-center shadow">
          <span class="text-white text-lg font-bold">
            {{ admin.name[0:2]|upper }}
          </span>
        </div>

        <div>
          <h2 class="text-base font-bold text-slate-800 dark:text-white">
            {{ admin.name }}
          </h2>
          <p class="text-xs text-slate-500 dark:text-slate-400">
            {{ admin.email }}
          </p>
        </div>
      </div>

      <div class="h-px bg-slate-300 dark:bg-slate-700 mb-4"></div>

      <!-- BOTÕES -->
      <div class="flex gap-2">

        <!-- EDITAR -->
        <button 
          onclick="abrirModalEditarAdmin(this)"
          data-id="{{ admin.id }}"
          data-nome="{{ admin.name }}"
          data-email="{{ admin.email }}"
          class="flex-1 px-3 py-1.5 rounded-lg 
                 bg-blue-100 dark:bg-blue-600/20 
                 text-blue-700 dark:text-blue-300 
                 border border-blue-300 dark:border-blue-500/30
                 hover:bg-blue-200 dark:hover:bg-blue-600/30 
                 transition text-xs font-medium">
          <i class="fa-solid fa-pen text-xs"></i> Editar
        </button>

        <!-- EXCLUIR / PROTEGIDO -->
        {% if admin.email != 'admin@admin.com' %}
        <button 
          onclick="abrirModalExcluirAdmin({{ admin.id }})"
          class="flex-1 px-3 py-1.5 rounded-lg 
                 bg-red-100 dark:bg-red-600/20 
                 text-red-700 dark:text-red-300 
                 border border-red-300 dark:border-red-500/30
                 hover:bg-red-200 dark:hover:bg-red-600/30 
                 transition text-xs font-medium">
          <i class="fa-solid fa-trash text-xs"></i> Excluir
        </button>
        {% else %}
        <button
          disabled
          class="flex-1 px-3 py-1.5 rounded-lg 
                 bg-slate-200 dark:bg-slate-800 
                 text-slate-400 cursor-not-allowed 
                 border border-slate-300 dark:border-slate-700
                 text-xs font-medium">
          <i class="fa-solid fa-lock text-xs"></i> Protegido
        </button>
        {% endif %}

      </div>

    </div>
    {% endfor %}

    {% if admins|length == 0 %}
    <div class="col-span-full text-center p-10 border-2 border-dashed rounded-xl">
      Nenhum administrador cadastrado.
    </div>
    {% endif %}

  </section>

</div>




<!-- ======================================================
     MODAIS — AGORA TAMBÉM LIGHT/DARK
====================================================== -->

<!-- NOVO ADMIN -->
<div id="modalNovoAdmin"
     class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-2xl 
              max-w-sm w-full border border-slate-300 dark:border-slate-700 relative">

    <button class="absolute top-2 right-3 text-slate-500 dark:text-slate-400 
                   hover:text-red-400 text-xl"
            onclick="fecharModalNovoAdmin()">&times;</button>

    <h2 class="text-xl font-bold mb-5 flex items-center gap-2 text-slate-800 dark:text-slate-100">
      <span class="p-2 rounded-xl bg-blue-500/10 dark:bg-blue-600/20 
                   border border-blue-400/40">
        <i class="fa-solid fa-user-plus text-blue-600 dark:text-blue-400 text-sm"></i>
      </span>
      Novo Administrador
    </h2>

    <form method="POST" action="/administradores/salvar" class="space-y-3">

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">Nome completo</label>
        <input type="text" name="nome" required
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">E-mail</label>
        <input type="email" name="email" required
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">Senha inicial</label>
        <input type="password" name="senha" required
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg shadow text-sm font-semibold">
        Salvar
      </button>

    </form>

  </div>
</div>




<!-- EDITAR ADMIN -->
<div id="modalEditarAdmin"
     class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-2xl max-w-sm w-full border 
              border-slate-300 dark:border-slate-700 relative">

    <button class="absolute top-2 right-3 text-slate-500 dark:text-slate-400 
                   hover:text-red-400 text-xl"
            onclick="fecharModalEditarAdmin()">&times;</button>

    <h2 class="text-xl font-bold mb-5 flex items-center gap-2 text-slate-800 dark:text-slate-100">
      <span class="p-2 rounded-xl bg-blue-500/10 dark:bg-blue-600/20 border border-blue-400/40">
        <i class="fa-solid fa-user-pen text-blue-600 dark:text-blue-400 text-sm"></i>
      </span>
      Editar Administrador
    </h2>

    <form method="POST" id="formEditarAdmin" class="space-y-3">

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">Nome</label>
        <input id="editar_nome" type="text" name="nome" required
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 rounded-lg 
                      text-slate-800 dark:text-slate-100">
      </div>

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">E-mail</label>
        <input id="editar_email" type="email" name="email" required
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <div>
        <label class="text-slate-600 dark:text-slate-300 text-xs">
          Nova Senha (opcional)
        </label>
        <input type="password" name="senha"
               class="w-full px-3 py-2 text-sm bg-slate-100 dark:bg-slate-800 
                      border border-slate-300 dark:border-slate-700 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <!-- SENHA MASTER (APENAS PARA ADMIN MASTER) -->
      <div id="campoSenhaMaster" class="hidden">
        <label class="text-red-600 dark:text-red-400 text-xs font-semibold">
          Senha Master (obrigatória)
        </label>
        <input type="password" name="senha_master"
               placeholder="Confirme a senha master"
               class="w-full px-3 py-2 text-sm bg-red-50 dark:bg-slate-800 
                      border border-red-300 dark:border-red-600 
                      rounded-lg text-slate-800 dark:text-slate-100">
      </div>

      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg shadow text-sm font-semibold">
        Atualizar
      </button>

    </form>

  </div>
</div>





<!-- EXCLUIR ADMIN -->
<div id="modalExcluirAdmin"
     class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white dark:bg-slate-900 p-5 rounded-2xl shadow-2xl max-w-sm w-full border 
              border-slate-300 dark:border-slate-700 relative">

    <button class="absolute top-2 right-3 text-slate-500 dark:text-slate-400 
                   hover:text-red-400 text-xl"
            onclick="fecharModalExcluirAdmin()">&times;</button>

    <h2 class="text-lg font-bold mb-3 flex items-center gap-2 text-slate-800 dark:text-slate-100">
      <span class="p-2 rounded-xl bg-red-500/10 dark:bg-red-600/20 border border-red-400/40">
        <i class="fa-solid fa-triangle-exclamation text-red-600 dark:text-red-400"></i>
      </span>
      Confirmar Exclusão
    </h2>

    <p class="text-xs text-slate-600 dark:text-slate-400 mb-4">
      Esta ação removerá o acesso deste administrador ao sistema.
    </p>

    <form method="POST" id="formExcluirAdmin">
      <button class="w-full bg-red-600 hover:bg-red-700 text-white py-2 
                     rounded-lg shadow text-sm font-semibold">
        Excluir
      </button>
    </form>

  </div>
</div>




<!-- ======================================================
     SCRIPTS
====================================================== -->
<script>
  /* ===============================
     NOVO ADMIN
  =============================== */
  function abrirModalNovoAdmin() {
    document.getElementById("modalNovoAdmin").classList.remove("hidden");
  }

  function fecharModalNovoAdmin() {
    document.getElementById("modalNovoAdmin").classList.add("hidden");
  }

  /* ===============================
     EDITAR ADMIN
  =============================== */
  function abrirModalEditarAdmin(btn) {
    const id = btn.dataset.id;
    const nome = btn.dataset.nome;
    const email = btn.dataset.email;
    const isMaster = email === "admin@admin.com";

    // Preenche campos
    document.getElementById("editar_nome").value = nome;
    document.getElementById("editar_email").value = email;
    document.getElementById("formEditarAdmin").action =
      "/administradores/editar/" + id;

    const emailInput = document.getElementById("editar_email");
    const campoSenhaMaster = document.getElementById("campoSenhaMaster");

    if (isMaster) {
      // Bloqueia e-mail
      emailInput.readOnly = true;
      emailInput.classList.add("opacity-60", "cursor-not-allowed");

      // Mostra campo senha master
      if (campoSenhaMaster) {
        campoSenhaMaster.classList.remove("hidden");
      }
    } else {
      // Libera e-mail
      emailInput.readOnly = false;
      emailInput.classList.remove("opacity-60", "cursor-not-allowed");

      // Esconde campo senha master
      if (campoSenhaMaster) {
        campoSenhaMaster.classList.add("hidden");
      }
    }

    document.getElementById("modalEditarAdmin").classList.remove("hidden");
  }

  function fecharModalEditarAdmin() {
    document.getElementById("modalEditarAdmin").classList.add("hidden");
  }

  /* ===============================
     EXCLUIR ADMIN
  =============================== */
  function abrirModalExcluirAdmin(id) {
    document.getElementById("formExcluirAdmin").action =
      "/administradores/excluir/" + id;
    document.getElementById("modalExcluirAdmin").classList.remove("hidden");
  }

  function fecharModalExcluirAdmin() {
    document.getElementById("modalExcluirAdmin").classList.add("hidden");
  }
</script>

{% endblock %}

