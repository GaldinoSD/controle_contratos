{% extends "base.html" %}
{% block content %}

<!-- ======================================================= -->
<!-- ===================== HEADER COMPACTO ================== -->
<!-- ======================================================= -->
<section class="mb-6 relative">

  <div class="rounded-xl p-5 
              bg-white/70 dark:bg-slate-900/80 
              shadow-lg border border-slate-300 dark:border-slate-800
              backdrop-blur-xl overflow-hidden relative">

    <!-- Glow -->
    <div class="absolute -top-8 -left-8 w-28 h-28 
                bg-blue-400/10 dark:bg-blue-600/20 
                blur-2xl rounded-full"></div>

    <div class="absolute bottom-0 right-0 w-28 h-28 
                bg-cyan-400/10 dark:bg-cyan-500/10
                blur-2xl rounded-full"></div>

    <div class="relative flex items-center gap-4">
      <div class="p-2.5 
                  bg-blue-500/10 dark:bg-blue-600/10 
                  rounded-lg border border-blue-300/40 dark:border-blue-500/20">
        <i class="fa-solid fa-chart-line 
                  text-blue-600 dark:text-blue-400 text-xl"></i>
      </div>

      <div>
        <h1 class="text-2xl font-bold 
                   text-slate-800 dark:text-white tracking-tight">
          Painel Geral
        </h1>
        <p class="text-xs mt-1 
                   text-slate-600 dark:text-slate-400">
          Resumo geral das empresas e tarefas.
        </p>
      </div>
    </div>

  </div>

</section>


<!-- ======================================================= -->
<!-- ======================== GRID ========================= -->
<!-- ======================================================= -->
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">

  {% for item in dados %}

  <!-- ====== CÁLCULO DAS PORCENTAGENS ====== -->
  {% set total = item.total if item.total > 0 else 1 %}
  {% set perc_concluidas = (item.concluidas / total * 100) %}
  {% set perc_pendentes = (item.pendentes / total * 100) %}
  {% set perc_atrasadas = (item.atrasadas / total * 100) %}


  <!-- CARD -->
  <div class="relative 
              bg-white/60 dark:bg-slate-900/60 
              backdrop-blur-xl rounded-xl 
              border border-slate-300 dark:border-slate-800 
              shadow-lg hover:shadow-2xl
              hover:-translate-y-[2px] transition-all duration-200 p-4 overflow-hidden">

    <!-- Glow interno -->
    <div class="absolute inset-0 
                bg-gradient-to-br 
                from-blue-300/10 dark:from-blue-600/10 
                via-transparent 
                to-slate-200/10 dark:to-slate-900/10">
    </div>

    <div class="relative z-10">
      
      <!-- Cabeçalho -->
      <div class="flex items-start justify-between mb-3">
        <div>
          <h2 class="text-lg font-semibold 
                     text-slate-800 dark:text-white 
                     flex items-center gap-2">
            <span class="p-1.5 
                         bg-blue-300/10 dark:bg-blue-600/10 
                         rounded-md border 
                         border-blue-300/30 dark:border-blue-500/10">
              <i class="fa-solid fa-building 
                        text-blue-600 dark:text-blue-300 text-sm"></i>
            </span>
            {{ item.empresa.name }}
          </h2>

          <p class="text-[11px] 
                    text-slate-600 dark:text-slate-400 mt-1">
            <span class="font-medium">CNPJ:</span> {{ item.empresa.cnpj }}
          </p>
        </div>

        <span class="px-1.5 py-0.5 text-[9px] rounded-full 
                     bg-emerald-400/20 dark:bg-emerald-600/20 
                     text-emerald-700 dark:text-emerald-300 
                     border border-emerald-400/40 dark:border-emerald-500/30 
                     font-semibold">
          Ativa
        </span>
      </div>

      <!-- Separador -->
      <hr class="border-slate-300 dark:border-slate-800 my-3">


      <!-- ========================================================================= -->
      <!-- ======================== MINI CARDS DE PORCENTAGEM ====================== -->
      <!-- ========================================================================= -->
      <div class="grid grid-cols-3 gap-2 mt-2 mb-4">

        <!-- Concluídas -->
        <div class="p-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-center">
          <p class="text-[10px] text-emerald-700 dark:text-emerald-300">Concluídas</p>
          <h3 class="font-bold text-emerald-700 dark:text-emerald-300 text-sm">
            {{ perc_concluidas | round(0) }}%
          </h3>
        </div>

        <!-- Pendentes -->
        <div class="p-2 rounded-lg bg-yellow-500/10 border border-yellow-500/20 text-center">
          <p class="text-[10px] text-yellow-700 dark:text-yellow-300">Pendentes</p>
          <h3 class="font-bold text-yellow-700 dark:text-yellow-300 text-sm">
            {{ perc_pendentes | round(0) }}%
          </h3>
        </div>

        <!-- Atrasadas -->
        <div class="p-2 rounded-lg bg-red-500/10 border border-red-500/20 text-center">
          <p class="text-[10px] text-red-700 dark:text-red-300">Atrasadas</p>
          <h3 class="font-bold text-red-700 dark:text-red-300 text-sm">
            {{ perc_atrasadas | round(0) }}%
          </h3>
        </div>

      </div>


      <!-- ========================================================================= -->
      <!-- ======================= INDICADORES ORIGINAIS =========================== -->
      <!-- ========================================================================= -->
      <div class="space-y-2.5">

        <!-- TOTAL -->
        <div class="flex justify-between items-center 
                    bg-slate-100 dark:bg-slate-900/40 
                    border border-slate-300 dark:border-slate-800 
                    rounded-lg py-2 px-3">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-list-check 
                      text-slate-700 dark:text-slate-300 text-xs"></i>
            <span class="text-xs text-slate-700 dark:text-slate-300">Total</span>
          </div>
          <span class="font-semibold text-slate-900 dark:text-white text-xs">
            {{ item.total }}
          </span>
        </div>

        <!-- CONCLUÍDAS -->
        <div class="flex justify-between items-center 
                    bg-emerald-200/30 dark:bg-emerald-900/20 
                    border border-emerald-300 dark:border-emerald-800/40 
                    rounded-lg py-2 px-3">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-circle-check 
                      text-emerald-700 dark:text-emerald-400 text-xs"></i>
            <span class="text-xs text-emerald-700 dark:text-emerald-300">Concluídas</span>
          </div>
          <span class="font-semibold text-emerald-800 dark:text-emerald-200 text-xs">
            {{ item.concluidas }}
          </span>
        </div>

        <!-- PENDENTES -->
        <div class="flex justify-between items-center 
                    bg-yellow-200/30 dark:bg-yellow-900/20 
                    border border-yellow-300 dark:border-yellow-800/40 
                    rounded-lg py-2 px-3">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-hourglass-half 
                      text-yellow-700 dark:text-yellow-300 text-xs"></i>
            <span class="text-xs text-yellow-700 dark:text-yellow-200">Pendentes</span>
          </div>
          <span class="font-semibold text-yellow-800 dark:text-yellow-200 text-xs">
            {{ item.pendentes }}
          </span>
        </div>

        <!-- ATRASADAS -->
        <div class="flex justify-between items-center 
                    bg-red-200/30 dark:bg-red-900/20 
                    border border-red-300 dark:border-red-800/40 
                    rounded-lg py-2 px-3">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-circle-exclamation 
                      text-red-700 dark:text-red-400 text-xs"></i>
            <span class="text-xs text-red-700 dark:text-red-300">Atrasadas</span>
          </div>
          <span class="font-semibold text-red-800 dark:text-red-300 text-xs">
            {{ item.atrasadas }}
          </span>
        </div>

        <!-- CONTRATOS -->
        <div class="flex justify-between items-center 
                    bg-blue-200/30 dark:bg-blue-900/20 
                    border border-blue-300 dark:border-blue-800/40 
                    rounded-lg py-2 px-3">
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-file-contract 
                      text-blue-700 dark:text-blue-300 text-xs"></i>
            <span class="text-xs text-blue-700 dark:text-blue-200">Contratos</span>
          </div>
          <span class="font-semibold text-blue-800 dark:text-blue-200 text-xs">
            {{ item.contratos }}
          </span>
        </div>

      </div>

    </div>

  </div>

  {% endfor %}

</div>

{% endblock %}
